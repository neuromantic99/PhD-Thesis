\chapter{\label{discussion}Discussion}
Pioneering work in systems neuroscience has greatly evolved our understanding of how the sensory world is encoded in the cortex \cite{hubel_receptive_1962, okun_diverse_2015, stringer_high-dimensional_2019}. Additionally, critical to the brain’s ability to process stimuli is that activity is robustly propagated between functionally and anatomically distinct regions \cite{wernicke_aphasische_1874, felleman_distributed_1991, zylberberg_robust_2017}; however, much less is known about how neural systems coordinate to achieve this goal. While this question is often addressed in meso-scale studies of particularly the primate brain \cite{raichle_default_2001, van_den_heuvel_network_2013}, less is known about how the dynamics of neural activity are structured at the single-cell level to propagate activity between brain regions (but see \cite{reid_divergence_2001, semedo_cortical_2019, vugt_threshold_2018}). And as even spatially co-localised neurons can be functionally distinct \cite{runyan_response_2010, marmigere_specification_2007, kim_three_2015, velez-fort_stimulus_2014}, single-cell resolution recordings will be necessary to understand the journey of neural activity through the brain.

We have developed a preparation with key features crucial for studying activity propagation through the cortical hierarchy. First we record simultaneously from two hierarchically organised and densely interconnected brain regions (S1 and S2) with single cell resolution. Activity has previously been shown to readily propagate between these two regions \cite{pons_physiological_1987, alloway_homotypical_1985, kamatani_experience-dependent_2007, aronoff_long-range_2010} and communication between S1 and S2 has been shown to convey signals relating to active behaviour in addition to sensory stimuli \cite{kwon_sensory_2016, chen_behaviour-dependent_2013, chen_long-range_2016, yamashita_membrane_2013, yamashita_target-specific_2016}. 

Further, in our preparation, the neural activity driving behaviour is controlled experimentally. Behaviour driven through direct cortical stimulation provides a unique window into neural function as recorded neurons unambiguously generate behavioural actions. This greatly simplifies interpretation of recorded activity as, during sensory guided behaviour, neurons in the cortex are coupled to a vast array of external variables \cite{stringer_spontaneous_2019, musall_single-trial_2019}, as well as the internal brain state \cite{okun_diverse_2015, arieli_dynamics_1996}. In addition, neural activity passes through several synapses between the periphery and the earliest sensory cortical regions, adding a layer of computational complexity at each step \cite{mccormick_sensory_1994, sherman_thalamic_2005, king_superior_2004}. As a result, behaviour driven through direct cortical stimulation adds to our existing knowledge of cortical function, as the initiation of the neural activity underpinning behaviour can be directly recorded.

This idea has been implemented previously in mammals in a single brain region using both optical \cite{huber_sparse_2008, histed_cortical_2014, gill_precise_2020, dalgleish_how_2020} and electrical stimulation \cite{romo_somatosensory_1998, houweling_behavioural_2008, doron_spiking_2014, tanke_single-cell_2018, buchan_stimulation_2018}, demonstrating that animals can detect activation of small groups of neurons or even single cells; these studies generally employed repeated stimulation of the same neurons trial to trial. We expand upon previous literature by employing two-photon photostimulation and varying the number and identity of stimulated cells trial by trial. As such, we ensure that mice do not become sensitive to spikes in specific neurons and rather must tune into population events generated by co-activation of small groups of cells. This is critical as computation in the mammalian brain typically relies on populations of neurons acting in concert rather than the activity of single neurons \cite{averbeck_neural_2006}. Moreover, by performing stimulations spanning the perceptual threshold of the mouse, we were able to study population events in S1 that were detected and thus propagated to the downstream regions required to drive behaviour, such as those generating the motor command to initiate licking. We were then able to compare this to population events that were not reported by the animal. Finally, the behavioural response to two-photon activation of small groups of  S1 neurons has previously been thoroughly characterised \cite{dalgleish_how_2020}, and we demonstrate that this behavioural paradigm is robust and reproducible as our work finds that a similar number of activated cells is required to reach the 50\% point on the psychometric curve pooled across animals. Our study is different to this previous work in that we vary the identity of stimulated cells trial by trial, rather than stimulating the same groups of neurons. As we find comparable behavioural results, this implies that populations of S1 neurons are able to generalise stimuli to elicit a behavioural report, regardless of the identity of the neurons stimulated.

\section{E/I balance}
We observe a diverse array of excitatory and inhibitory neural responses to two-photon photostimulation both locally in S1 and downstream in S2. While calcium imaging with GCaMP does not visualise inhibition explicitly, it has been shown that deviations of fluorescence traces below baseline is indicative of inhibition of tonically active neurons \cite{vanwalleghem_calcium_2021}. We find that on average, perceived stimuli (hit trials) are represented by a short period of excitation followed by a period of inhibition. This feature is expected from recordings made in S1 during whisker stimulation \cite{gabernet_somatosensory_2005, wilent_dynamics_2005}, however we show that it applies to activity arising directly from photostimulation in S1 and in activity in S2, propagated from S1.  Further we show that, in agreement with previous results \cite{dalgleish_how_2020}, S1 responds to excitatory two-photon photostimulation with a balancing inhibitory response. This is consistent with inhibition-stabilized networks (ISNs), formed from both strong excitatory and inhibitory recurrent connectivity. In silico, strong excitatory connectivity enables amplification of input patterns \cite{murphy_balanced_2009}, persistent activity \cite{amit_model_1997}, and signal propagation between brain areas \cite{joglekar_inter-areal_2018} while inhibition tracks excitation to prevent unstable dynamics \cite{sanzeni_inhibition_2020}. We find evidence of amplification as stimulating 10s of neurons in S1 excites > 5\% of recorded neurons, likely equating to hundreds or thousands of neurons total in the volume surrounding directly photostimulated cells. Next, perceived stimuli are decodable from both S1 and S2 for several seconds following photostimulation. As stimulation generally only transiently activates individual neurons, this is consistent with persistent activity resulting from recurrent connectivity \cite{daie_targeted_2021, seung_how_1996}. This is likely not only an artifact resulting from the long temporal dynamics of calcium imaging as our persistent activity lasts longer than would be expected from the temporal dynamics of GCaMP6s \cite{daie_targeted_2021, chen_ultrasensitive_2013}. Finally, we find that perceived stimuli are readily propagated from S1, and E/I balance extends to the downstream region S2 (although excitation and inhibition are less tightly coupled), consistent with data-constrained models of ISNs with long range connectivity \cite{joglekar_inter-areal_2018}. Taken together, we show that while populations of somatosensory cortex neurons exhibit a diverse range of responses to photostimulation of small groups of neurons, their activity is consistent with ISN models with recurrent connectivity. As perceived stimuli elicit both persistent and propagating activity, it is possible that recurrent connectivity consistent with ISN models, plays a role in this propagation.

\section{Stimulus generalisation}
We find that perceived stimuli (hit trials) are decodable from populations of neurons in S1 and S2, using a linear model. Our linear model classifies trial types in the held-out test set, on an individual trial level, based on the weighted sum of each neuron’s activity. However the weights are trained across the entire training set, formed from multiple trials. As a result, accurate decoding of the stimulus requires that individual neurons show a consistent increase or decrease in both training set and test set trials. Although we vary the identity of stimulated neurons trial by trial, hit trials are readily decodable from S1 and S2. This means that the neural response to perceived stimulation is comparable trial to trial in both brain regions, implying that the population generalises its representation of the stimulus. On miss trials, the presence of the stimulus is only decodable for a brief period in S1 immediately following stimulation, showing that non-perceived stimuli are not generalised across both brain regions. Stimulus generalisation is a well characterised phenomenon in psychology \cite{pavlov_conditioned_1927, pearce_model_1987}, biological circuits \cite{xu_neural_2013, henschke_reward_2020} and in artificial neural networks \cite{sietsma_creating_1991, jacot_neural_2018-1, summerfield_structure_2020}, which endows an agent with the ability to effectively interpret novel stimuli based on prior experience. This process has been shown to be enhanced if the stimulus is coupled to reward, matching our results \cite{henschke_reward_2020}. Hence we show that generalisation of neural activity is a feature of stimuli that are both perceived and propagated between brain regions. This generalisation is also observed in a downstream region from where the activity was initiated, implying that perceived neural activity may remain generalised throughout its journey through the cortex.

\section{Signal-to-noise ratio}
The signal-to-noise ratio (SNR) of a sensory neuron \cite{barlow_three_1969} or population of neurons \cite{zohary_correlated_1994} is often used to quantify the fidelity of the representation of a stimulus, whereby a higher SNR means that the sensory stimulus is more robustly represented as neural activity. Indeed, one of the functions of the highly recurrent circuitry in sensory cortex is thought to be the amplification of relevant activity arising from feedforward inputs, in order to enhance SNR \cite{douglas_recurrent_1995-1, ganguli_one-dimensional_2008}. Despite the well-characterised importance of high SNR in the local representation of sensory stimuli, less is known about how the SNR of a stimulus relates to its likelihood to propagate downstream. Here we replace the feedforward inputs employed in silico with direct cortical activation and quantify noise as the population variance. We find that the probability a photostimulus was perceived, and was thus propagated downstream, is dictated by the SNR of the stimulus. The relationship between noise and signal propagation has been extensively studied in artificial neural networks \cite{vogels_signal_2005, diesmann_stable_1999, ozer_weak_2010, guo_signal_2011}. These studies show that a degree of ongoing noise is necessary for reliable propagation of activity packets between layers, however an excess of noise disrupts propagation \cite{guo_signal_2011}. These in silico results are supported here as the cortex does not operate in a zero-noise regime in vivo \cite{vreeswijk_chaotic_1998-1, faisal_noise_2008-1, anderson_contribution_2000, burns_spontaneous_1976, london_sensitivity_2010}, therefore we never observe a scenario where additional noise supports propagation. Taken together, we show that high signal-to-noise ratio activity is more reliably propagated between distinct regions of the mammalian cortex.

Although we find evidence that signal-to-noise ratio is a key neural feature facilitating activity propagation, we do not find evidence that inter-neuronal correlations are involved in this process. This appears to contrast with an elegant modelling study \cite{zylberberg_robust_2017} which showed that robust activity propagation between upstream and downstream cell layers was dependent on the covariance structure in the first layer. However this finding was made by varying the covariance matrix of the first later on a trial by trial basis and examining the effect on the second layer. We are not able to control the covariance matrix of an entire cell layer in vivo, hence further work is required to examine how the covariance structure of a population impacts its ability to propagate activity. 

In sum, our study examines for the first time how injecting activity into small groups of neurons in an upstream brain region impacts both behaviour and propagation of activity to a downstream region. Through this, we find indications that the somatosensory cortex operates as an ISN, that the connectivity structure of the ISN may assist in propagating activity and that both stimulus generalisation and signal-to-noise ratio are key neural features that may participate in ensuring robust stimulus propagation to coordinate brain regions and drive behaviour. 

\section{Futher work}
Further work with experimental manipulations of neural activity, such as two-photon photostimulation, is required to more closely examine how E/I balance, stimulus generalisation and signal-to-noise ratio impacts propagation of activity and its relationship to behaviour. Specifically, the causal link between these features of neural activity, behaviour and propagation could be further established using a closed-loop approach \cite{zhang_closed-loop_2018} whereby neural features such as noise are monitored online \cite{giovannucci_onacid_2017-1}. Photostimulation could then be delivered, for example, when the stimulated population is in a low-noise state and a high-noise state. Stimuli delivered in a low-noise state should elicit more robust propagation of activity and show an increased likelihood of driving a hit trial.  

It also follows from this work that feedback propagation of activity could be studied in the same framework. Most obviously, mice could be trained to report photostimulation of S2 neurons, while propagation of activity to S1 is monitored. Feedback of activity from higher to lower brain regions in the canonical pathway of sensory information flow plays a key role in many theories of cortical function \cite{rao_predictive_1999, lillicrap_backpropagation_2020}. Hence studying how feedback activity is propagated and the states employed by the brain to facilitate this could advance our understanding of cortical computation. Finally, it has been shown that mice can perceive optogenetic stimulation regardless of the brain region to which it is applied \cite{luis-islas_interoceptive_2021}. Hence the preparation described here could be applied to study any brain region, or the connections between them, and so further work could focus on whether propagating activity is shaped in the same way throughout the brain, or whether motor, frontal or subcortical regions employ a different strategy. Overall the experimental setup we describe here has great utility for assessing a wide range of brain regions, features of neural activity and theories of brain function.
